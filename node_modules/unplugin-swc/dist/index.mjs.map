{"version":3,"sources":["../src/index.ts","../node_modules/.pnpm/defu@6.1.3/node_modules/defu/dist/defu.mjs","../src/resolve.ts","../node_modules/.pnpm/path-exists@5.0.0/node_modules/path-exists/index.js"],"sourcesContent":["import path from 'path'\nimport { createFilter } from '@rollup/pluginutils'\nimport { transform } from '@swc/core'\nimport { defu } from 'defu'\n// @ts-expect-error missing types\nimport { loadTsConfig } from 'load-tsconfig'\nimport { createUnplugin } from 'unplugin'\nimport { resolveId } from './resolve'\nimport type { FilterPattern } from '@rollup/pluginutils'\nimport type { JscConfig, Options as SwcOptions, TransformConfig } from '@swc/core'\n\nexport type Options = SwcOptions & {\n  include?: FilterPattern\n  exclude?: FilterPattern\n  tsconfigFile?: string | boolean\n}\n\ntype WithRequiredProperty<Type, Key extends keyof Type> = Type & {\n  [Property in Key]-?: Type[Property];\n}\n\ntype SWCOptions = WithRequiredProperty<JscConfig, 'parser' | 'transform'>\n\nexport default createUnplugin<Options | undefined>(\n  ({ tsconfigFile, minify, include, exclude, ...options } = {}) => {\n    const filter = createFilter(\n      include || /\\.[jt]sx?$/,\n      exclude || /node_modules/,\n    )\n\n    return {\n      name: 'swc',\n\n      resolveId,\n\n      async transform(code, id) {\n        if (!filter(id)) return null\n\n        const compilerOptions\n          = tsconfigFile === false\n            ? {}\n            : loadTsConfig(\n              path.dirname(id),\n              tsconfigFile === true ? undefined : tsconfigFile,\n            )?.data?.compilerOptions || {}\n\n        const isTs = /\\.tsx?$/.test(id)\n\n        let jsc: SWCOptions = {\n          parser: {\n            syntax: isTs ? 'typescript' : 'ecmascript',\n          },\n          transform: {},\n        }\n\n        if (compilerOptions.jsx) {\n          if (jsc.parser.syntax === 'typescript') {\n            jsc.parser.tsx = true\n          } else {\n            jsc.parser.jsx = true\n          }\n          Object.assign<TransformConfig, TransformConfig>(jsc.transform, {\n            react: {\n              pragma: compilerOptions.jsxFactory,\n              pragmaFrag: compilerOptions.jsxFragmentFactory,\n              importSource: compilerOptions.jsxImportSource,\n            },\n          })\n        }\n\n        if (compilerOptions.experimentalDecorators) {\n          // class name is required by type-graphql to generate correct graphql type\n          jsc.keepClassNames = true\n          jsc.parser.decorators = true\n          Object.assign<TransformConfig, TransformConfig>(jsc.transform!, {\n            legacyDecorator: true,\n            decoratorMetadata: compilerOptions.emitDecoratorMetadata,\n          })\n        }\n\n        if (compilerOptions.target) {\n          jsc.target = compilerOptions.target\n        }\n\n        if (options.jsc) {\n          jsc = defu<SWCOptions, SWCOptions[]>(options.jsc, jsc)\n        }\n\n        const result = await transform(code, {\n          filename: id,\n          sourceMaps: true,\n          ...options,\n          jsc,\n        })\n        return {\n          code: result.code,\n          map: result.map && JSON.parse(result.map),\n        }\n      },\n\n      vite: {\n        config() {\n          return {\n            esbuild: false,\n          }\n        },\n      },\n\n      rollup: {\n        async renderChunk(code, chunk) {\n          if (minify) {\n            const result = await transform(code, {\n              sourceMaps: true,\n              minify: true,\n              filename: chunk.fileName,\n            })\n            return {\n              code: result.code,\n              map: result.map,\n            }\n          }\n          return null\n        },\n      },\n    }\n  },\n)\n","function _defu(baseObject, defaults, namespace = \".\", merger) {\n  if (!_isPlainObject(defaults)) {\n    return _defu(baseObject, {}, namespace, merger);\n  }\n  const object = Object.assign({}, defaults);\n  for (const key in baseObject) {\n    if (key === \"__proto__\" || key === \"constructor\") {\n      continue;\n    }\n    const value = baseObject[key];\n    if (value === null || value === void 0) {\n      continue;\n    }\n    if (merger && merger(object, key, value, namespace)) {\n      continue;\n    }\n    if (Array.isArray(value) && Array.isArray(object[key])) {\n      object[key] = [...value, ...object[key]];\n    } else if (_isPlainObject(value) && _isPlainObject(object[key])) {\n      object[key] = _defu(\n        value,\n        object[key],\n        (namespace ? `${namespace}.` : \"\") + key.toString(),\n        merger\n      );\n    } else {\n      object[key] = value;\n    }\n  }\n  return object;\n}\nfunction _isPlainObject(value) {\n  if (value === null || typeof value !== \"object\") {\n    return false;\n  }\n  const prototype = Object.getPrototypeOf(value);\n  return (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value);\n}\nfunction createDefu(merger) {\n  return (...arguments_) => (\n    // eslint-disable-next-line unicorn/no-array-reduce\n    arguments_.reduce((p, c) => _defu(p, c, \"\", merger), {})\n  );\n}\nconst defu = createDefu();\nconst defuFn = createDefu((object, key, currentValue) => {\n  if (object[key] !== void 0 && typeof currentValue === \"function\") {\n    object[key] = currentValue(object[key]);\n    return true;\n  }\n});\nconst defuArrayFn = createDefu((object, key, currentValue) => {\n  if (Array.isArray(object[key]) && typeof currentValue === \"function\") {\n    object[key] = currentValue(object[key]);\n    return true;\n  }\n});\n\nexport { createDefu, defu as default, defu, defuArrayFn, defuFn };\n","import fs from 'fs'\nimport path from 'path'\nimport { pathExists } from 'path-exists'\n\nconst RESOLVE_EXTENSIONS = ['.tsx', '.ts', '.jsx', '.js', '.mjs', '.cjs']\n\nconst resolveFile = async(resolved: string, index = false) => {\n  for (const ext of RESOLVE_EXTENSIONS) {\n    const file = index\n      ? path.join(resolved, `index${ext}`)\n      : `${resolved}${ext}`\n    if (await pathExists(file)) return file\n  }\n}\n\nexport const resolveId = async(importee: string, importer?: string) => {\n  if (importer && importee[0] === '.') {\n    const absolutePath = path.resolve(\n      importer ? path.dirname(importer) : process.cwd(),\n      importee,\n    )\n\n    let resolved = await resolveFile(absolutePath)\n\n    if (\n      !resolved\n      && (await pathExists(absolutePath))\n      && (await fs.promises.stat(absolutePath).then(stat => stat.isDirectory()))\n    ) {\n      resolved = await resolveFile(absolutePath, true)\n    }\n\n    return resolved\n  }\n}\n","import fs, {promises as fsPromises} from 'node:fs';\n\nexport async function pathExists(path) {\n\ttry {\n\t\tawait fsPromises.access(path);\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nexport function pathExistsSync(path) {\n\ttry {\n\t\tfs.accessSync(path);\n\t\treturn true;\n\t} catch {\n\t\treturn false;\n\t}\n}\n"],"mappings":"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","names":["path","fs","path","fs","path"]}